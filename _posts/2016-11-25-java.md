---
layout: post
title: "Java中日期问题总结"
description: ""
category: 
tags: []
---
{% include JB/setup %}

由于在写程序的过程中，经常遇到日期的转换，为此通过参考网上的几篇总结，记录下自己需要的问题，以备后用，本文讨论的主要是关于Java API 中 Date, Calendar, TimeZone和DateFormat的使用，和时区的转换问题。

## Date

- 需要说明的是 Date 无时区，

- 但date.toString() 则是按当前 JVM 的默认时区来格式化的，也就是 TimeZone.getDefault() 获得的时区，

- 同时 date.toString() 是按照 "EEE MMM dd HH:mm:ss zzz yyyy" 来格式化的；

- 类Date表示特定的瞬间，精确到毫秒。获得一个表示当前时间的Date对象有两种方式：

```
	Date date = new Date();  
	Date date = Calendar.getInstance().getTime(); 
```

Date对象本身所存储的毫秒数可以通过date.getTime()方法得到；该函数返回自1970年1月1日 00:00:00 GMT以来此对象表示的毫秒数。
 
Calendar的getInstance()方法有参数为TimeZone和Locale的重载，可以使用指定时区和语言环境获得一个日历。无参则使用默认时区和语言环境获得日历。



## Date to String

```
	SimpleDateFormat format = new SimpleDateFormat("yyyy-MM-dd HH:mm:ss.SSS");  
	String strDate = format.format(date);
```

## String to Date

```
	SimpleDateFormat format = new SimpleDateFormat("yyyy-MM-dd HH:mm:ss");  
	Date date = format.parse(strDate);	
```

> DateFormat是是日期/时间格式化子类的抽象类，它以与语言无关的方式格式化并解析日期或时间。日期/时间格式化子类（如 SimpleDateFormat）允许进行格式化（也就是日期 -> 文本）、解析（文本-> 日期）和标准化。将日期表示为 Date 对象，或者表示为从 GMT（格林尼治标准时间）1970 年 1 月 1 日 00:00:00 这一刻开始的毫秒数。SimpleDateFormat则是一个以与语言环境有关的方式来格式化和解析日期的具体类，可以以“日期和时间模式”字符串指定日期和时间格式。我们函数中所用模式字符串为"yyyy-MM-dd HH:mm:ss"，则输出日期："2013-07-16 00:00:00"

## 时区转换

> 为了克服时间上的混乱，1884年在华盛顿召开的一次国际经度会议（又称国际子午线会议[1]）上，规定将全球划分为24个时区（东、西各12个时区）。规定英国（格林尼治天文台旧址）为中时区（零时区）、东1-12区，西1-12区。每个时区横跨经度15度，时间正好是1小时。最后的东、西第12区各跨经度7.5度，以东、西经180度为界。每个时区的中央经线上的时间就是这个时区内统一采用的时间，称为区时，相邻两个时区的时间相差1小时。例如，中国东8区的时间总比泰国东7区的时间早1小时，而比日本东9区的时间迟1小时。因此，出国旅行的人，必须随时调整自己的手表，才能和当地时间相一致。凡向西走，每过一个时区，就要把表拨慢1小时（比如2点拨到1点）；凡向东走，每过一个时区，就要把表拨快1小时（比如1点拨到2点）。并且规定英国（格林尼治天文台旧址）为本初子午线，即零度经线。

GMT 0:00 格林尼治标准时间
UTC +00:00 校准的全球时间

> GMT时间：即格林威治平时（Greenwich Mean Time）。平太阳时是与视太阳时对应的，由于地球轨道非圆形，运行速度岁地球与太阳距离改变而出现变化，因此视太阳时欠缺均匀性。为了纠正这种不均匀性，天文学家计算地球非圆形轨迹与极轴倾斜对视太阳时的效应。平太阳时就是指经修订之后的视太阳时。在格林威治子午线上的平太阳时称为世界时（UTC），又叫格林威治平时（GMT）。

**TimeZone**表示时区偏移量，本质上以毫秒数保存与GMT的差值。获取TimeZone可以通过时区ID，如"America/New_York"，也可以通过GMT+/-hh:mm来设定。例如北京时间可以表示为GMT+8:00。
TimeZone.getRawOffset()方法可以用来得到当前时区的标准时间到GMT的偏移量。上段提到的"America/New_York"和"GMT+8:00"两个时区的偏移量分别为-18000000和28800000。

因此，时区转换的`原理`就是：在时区间转换时间时，首先用原时间减掉原时间所在时区相对于GMT的偏移量，得到原时间相对与GMT的值，再加上目标时区相对GMT的偏移量即可。然后按照指定日期格式重新转换成Date对象。

示例代码如下(东京时间转北京时间)：

```	
    public class DateTransformer
    {
		public static final String DATE_FORMAT = "yyyy-MM-dd HH:mm:ss";
       
    	public static String dateTransformBetweenTimeZone(Date sourceDate, DateFormat formatter, TimeZone sourceTimeZone, TimeZone targetTimeZone) {
    		Long targetTime = sourceDate.getTime() - sourceTimeZone.getRawOffset() + targetTimeZone.getRawOffset();
        	return DateTransformer.getTime(new Date(targetTime), formatter);
    	}
       
    	public static String getTime(Date date, DateFormat formatter){
       		return formatter.format(date);
    	}
       
    	public static void main(String[] args){
    		DateFormat formatter = new SimpleDateFormat(DATE_FORMAT);
    		Date date = Calendar.getInstance().getTime();
    		TimeZone srcTimeZone = TimeZone.getTimeZone("GMT+8");
    		TimeZone destTimeZone = TimeZone.getTimeZone("GMT+9");
    		System.out.println(DateTransformer.dateTransformBetweenTimeZone(date, formatter, srcTimeZone, destTimeZone));
    	}
	}
```


